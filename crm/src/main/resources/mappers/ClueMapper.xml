<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mryang.crm.workbench.mapper.ClueMapper">

    <sql id="clue">
        id,
        fullname,
        appellation,
        owner,
        company,
        job,
        email,
        phone,
        website,
        mphone,
        `state`,
        `source`,
        createBy,
        createTime,
        editBy,
        editTime,
        description,
        contactSummary,
        nextContactTime,
        address
    </sql>

    <select id="queryClueListByPage" resultType="clue">
        select
            c.id,
            c.fullname,
            c.appellation,
            u.name,
            c.company,
            c.job,
            c.email,
            c.phone,
            c.website,
            c.mphone,
            c.`state`,
            c.`source`,
            c.createBy,
            c.createTime,
            c.editBy,
            c.editTime,
            c.description,
            c.contactSummary,
            c.nextContactTime,
            c.address
        from tbl_clue c,tbl_user u
        where u.id = c.owner
        order by c.createBy desc
        limit #{pageNo},#{pageSize}
    </select>

    <select id="clueListCount" resultType="int">
        select count(*) from tbl_clue
    </select>

    <select id="queryClueById" resultType="clue">
        select *
        from tbl_clue
        where id=#{id}
    </select>

    <select id="queryClueByRetrieve" resultType="clue">
        select *
        from tbl_clue
        <where>

            <if test="company !='' and company != null">
                and company like '%' #{company} '%'
            </if>

            <if test="fullname != null and fullname!=''">
                and fullname like '%' #{fullname} '%'
            </if>
            <if test="phone != null and phone!=''">
                and phone=#{phone}
            </if>
            <if test="source != null and source!=''">
                and `source`=#{source}
            </if>
            <if test="createBy != null and createBy!=''">
                and createBy like '%' #{createBy} '%'
            </if>
            <if test="myphone != null and myphone!=''">
                and myphone=#{myphone}
            </if>
            <if test="state != null and state!=''">
                and `state`=#{state}
            </if>
        </where>
    </select>


    <insert id="saveClue">
        insert into tbl_clue(
        id,
        owner,
        company,
        appellation,
        fullname,
        job,
        email,
        phone,
        website,
        mphone,
        `state`,
        `source`,
        description,
        contactSummary,
        nextContactTime,
        createBy,
        createTime,
        address)
        values(
        #{id},
        #{owner},
        #{company},
        #{appellation},
        #{fullname},
        #{job},
        #{email},
        #{phone},
        #{website},
        #{mphone},
        #{state},
        #{source},
        #{description},
        #{contactSummary},
        #{nextContactTime},
        #{createBy},
        #{createTime},
        #{address}
        )

    </insert>


</mapper>